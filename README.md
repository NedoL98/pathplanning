# PathPlanning.ru :: автоматическое планирование траектории
Недолужко Андрей Алексеевич, группа 161-1

## Инструкция по компиляции и запуску программы

Компиляция программа осуществляется с помощью утилиты qmake. 

Для запуска программы необходимо в командной строке прописать путь до входного файла (структура и пример такого файла описаны ниже), а затем запустить программу. Альтернативный способ - скомпилировать программу, а затем открыть в ней входной файл.

Отработав, программа создаёт лог-файл, структура и пример которого также описаны ниже.

## Актуальность задачи
Задача планирования оптимальной траектории на плоскости возникает во множестве ситуаций - от необходимости автомобилисту найти кратчайший путь до дома до реализации искусственного интеллекта в компьютерной игре. Данная проблема возникает при разработке приложений, связанных с оцифровкой карт местности (Яндекс.Карты, Google Maps и т.д.), или при создании тех же компьютерных игр. 

## Обзор существующих решений
На данный момент самым распространённым решением данной задачи является применение так или иначе модифицированного алгоритма А*. Данный алгоритм является наиболее эффективным алгоритмом как по времени работы, так и по затрачиваемой памяти. 

## Технологические решения
При разработке проекта используются следующие технологии:

- C++ 

Широко распространённый объектно-ориентированный язык программирования, с помощью которого и будет реализована программа для решения задачи. Является компилируемым, следовательно, имеет преимущество в производительности перед другими языками.
- Qt Creator

Удобная IDE, свободно распространяемая для научных и учебных проектов.
- XML

Инструмент для задания входных/выходных данных. Является кроссплатформенным, файл с таким расширением можно открыть практически на любом современном устройстве. 

## План работы по реализации функциональности проекта 
- Изучить материалы по поисковым алгоритмам (до 20.11.2017).
- Написать программу, в которой реализован какой-то алгоритм поиска, считывание карты и вывод пути в лог-файл (до 01.12.2017). 
- Реализовать алгоритм A*, исследовать эффективность различных эвристический функций (до 01.01.2018).
- Реализовать алгоритм Theta*, алгоритм Брезенхема, изучить другие алгоритмы аппроксимации линий на плоскости (до 15.02.2018).
- Реализовать алгоритм JPS (до 10.04.2018).
- Приступить к установке ROS/Gazebo для встраивания алгоритмов планирования в систему управления мобильным роботом (до 01.06.2018).

# Формат входных данных
[Пример входных данных](https://drive.google.com/file/d/1rrogXVwU7x2C3rYJlBxp9RT1zQ4GW7p0/view?usp=sharing)

Входные данные представляют из себя XML-файл. Он разделён на три основные части:

## Map

- width, height (целые числа) - соответственно ширина и высота карты.
- cellsize (целое число) - размер одной ячейки в условных единицах. Является необязательным параметром.
- startx, starty, finishx, finishy (целые числа, лежащие в отрезках [0; width] и [0; height]) - соответственно координаты старта и финиша.
- grid (матрица размера width * height) - описание карты. Проходимые области обозначены нулями, непроходимые - единицами.

## Algorithm

- searchtype (строка) - алгоритм, используемый для поиска пути. Например, A* (astar), Theta* (theta), JPS (jp_search), Dijkstra (djkstra).
- metrictype (строка) - заданная на плоскости метрика. Например, Евклидова метрика (Euclidean), Манхэтеннская метрика (Manhattan), расстояние Чебышева (Chebyshev) и диагональное расстояние (Diagonal).
- breakingties (строка) - параметр, отвечающий за алгоритм выбора новой вершины в случае, когда F- значения нескольких вершин совпадают.
- hweight (целое число) - весовой параметр эвристики.
- allowdiagonal (true/false) - возможность строить пути, проходящие по диагонали (а не только по квадратной сетке).
- cutcorners (true/false) - возможность "срезать углы", как показано на рисунке:

![Alt text](/images/corner.jpg)

- allowsqueeze (true/false) - возможность проходить между двумя препятствиями, как показано на рисунке:

![Alt text](/images/squeze.jpg)

## Options

- loglevel (0/0.5/1/1.5/2) - "уровень логирования" отвечает за подробность лог-файла.
- logpath, logfilename (строки) - необязательные параметры, отвечающие соответственно за то, где создаётся лог-файл, и как он называется.

## Формат выходных данных
[Пример выходных данных](https://drive.google.com/file/d/1qmQSBKhjzPsREo1HtBrBVpinmlO7b4Fg/view?usp=sharing)

Выходные данные также представляют из себя XML-файл. Первые три раздела выходного файла в точности повторяют аналогичные разделы во входных данных (секции Map, Algorithm и Options). Далее в выходном файле следует часть Log.

## Log
- summary - краткое описание найденного пути (количество шагов, проделанных алгоритмом, количество вершин, посещённых алгоритмом, длина пути, масштабированная длина пути, время, за которое был найден путь).
- path (матрица размера width * height) - описание карты, с найденным путём. Путь обозначается звёздочками ('*').
- lplevel - представление найденного пути, как последовательность соседних вершин на карте.
- hplevel - представление найденного пути, как последовательность вершин, между которыми совершается движение в одном и том же направлении.

## Описание архитектуры программного продукта

Программа представляет из себя набор .cpp и .h файлов. Каждому алгоритму поиска соответствует свой файл. Отдельные файлы выделены для описания карты, опций и записи в лог-файл.

Структура программы:
##### - isearch.h - основной хедер, в котором реализована работа с различными алгоритмами поиска.

  - startSearch - функция, в которой происходит поиск пути.
  - makePrimaryPath, makeSecondaryPath - функции, с помощью которых восстанавливается найденный путь и "сжатый" путь соответственно.

##### - node.h - структура единичного узла карты.

  - i, j - координаты текущей клетки.
  - F, g, H - текущий приоритет узла, расстояние до стартовой клетки и эвристическое расстояние до конечной клетки соответственно.
  - parent - указатель на родителя текущего узла. Равен nullptr для стартовой клетки.
  
##### - map.h - структура карты, описание стартовой и конечных точек.

  - height, width - размер карты по горизонтали и вертикали соответственно.
  - start_i, start_j - координаты стартовой клетки.
  - goal_i, goal_j - координаты конечной клетки.

##### - astar.h, dijkstra.h, theta.h, jps.h - описание алгоритмов поиска. 

  - hweight - весовой параметр эвристики.
  - breakingties - параметр, отвечающий за алгоритм выбора новой вершины в случае, когда F- значения нескольких вершин совпадают.

## Заключение

Были реализованы следующие алгоритмы поиска пути: Dijkstra, A*, Theta*, JPS. Работа алгоритмов протестирована на различных картах, результат провалидирован с заведомо верными решениями. 

Реализован поиск пути в трёхмерном случае с помощью модифицированного алгоритма A*. 
